<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	<title>ACHE Crawler Search</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link href="css/styles.css" rel="stylesheet">
</head>
<body ng-app="ache-search" ng-controller="AcheSearchController" eui-index="currentDomain.index">

  <nav class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
    	<div class="navbar-header">
            <a class="navbar-brand" rel="home" href="#"><i class="glyphicon glyphicon-search"></i>&nbsp;ACHE Crawler Search</a>
    		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
    		<span class="sr-only">Toggle navigation</span>
    		<span class="icon-bar"></span>
    		<span class="icon-bar"></span>
    		<span class="icon-bar"></span>
    		</button>
    	</div>
    	<div class="collapse navbar-collapse">
    		<ul class="nav navbar-nav navbar-right">
    			<li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <i class="glyphicon glyphicon-comment"></i>&nbsp;&nbsp;{{currentDomain.name}}<b class="caret"></b>
            </a>
            
            <ul class="dropdown-menu">
              <li ng-repeat="domain in domains">
                <a ng-click="changeIndex($index)">{{domain.name}}</a>
              </li>
            </ul>

          </li>
    		</ul>
    	</div>
    </div>
  </nav>

  <div class="container">
    
    <!--left-->
    <div class="col-sm-4 col-facets">
          <div class="panel panel-default">
            <div class="panel-heading"><i class="glyphicon glyphicon-globe"></i> Top private domains</div>
            <div class="panel-body">
              <eui-checklist field="'topPrivateDomain'" size="10"></eui-checklist> <!-- ACTION: change to field to use as facet -->
            </div>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading"><i class="glyphicon glyphicon-list-alt"></i> Top-terms in title</div>
            <div class="panel-body">
              <eui-singleselect field="'title'" size="10"></eui-singleselect>
            </div>
          </div>
           <div class="panel panel-default">
            <div class="panel-heading"><i class="glyphicon glyphicon-list-alt"></i> Top-terms in &lt;meta&gt; tag</div>
            <div class="panel-body">
              <eui-singleselect field="'wordsMeta'" size="10"></eui-singleselect>
            </div>
          </div>
    </div><!--/left-->
    
    <!--center-->
    <div class="col-sm-8">
      <div class="row">
        <div class="col-sm-12 col-md-12">
            <form class="navbar-form" role="search" style="padding: 10px 0px;">
              <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search" eui-query="ejs.MatchQuery('title', querystring)" ng-model="querystring" eui-enabled="querystring.length" />
                  <div class="input-group-btn">
                      <button class="btn btn-default"><i class="glyphicon glyphicon-search"></i></button>
                  </div>
              </div>
            </form>
        </div>
      </div>
      <hr />
      <div ng-repeat="doc in indexVM.results.hits.hits">
        <div class="row searchhit">
          <div class="col-xs-12">
            <h4><a href="{{doc._source.url}}" class="searchhit-title">{{doc._source.title}}</a></h4>
            <a href="{{doc._source.url}}" class="searchhit-url">{{doc._source.url}}</a>
            <p class="searchhit-snippet">{{doc._source.text | json | asCleanText | limitTo: 325}}...</p>
            <ul class="list-inline">
              <li><b> Fetched at:</b> <span class="label label-default">{{doc._source.retrieved | asDate | date:'medium'}}</span></li>
              <!-- <li><a href="#"><i class="glyphicon glyphicon-comment"></i> 2 Comments</a></li>
              <li><a href="#"><i class="glyphicon glyphicon-share"></i> 14 Shares</a></li> -->
            </ul>
          </div>
        </div>
        <hr />
      </div>
      <eui-simple-paging></eui-simple-paging>
    </div><!--/center-->
    <hr>
  </div><!--/container-fluid-->

	<!-- script references -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

  <!-- ElastiUI -->
  <script src="http://code.angularjs.org/1.2.16/angular.js"></script>
  <script src="http://rawgit.com/YousefED/ElasticUI/master/examples/demo/lib/elasticsearch.angular.js"></script>
  <script src="http://rawgit.com/YousefED/ElasticUI/master/examples/demo/lib/elastic.js"></script>
  <script src="http://rawgit.com/YousefED/ElasticUI/master/dist/elasticui.min.js"></script>
  <script>


  angular
      // ElasticUI config
      .module('ache-search', ['elasticui'])
      //.constant('euiHost', 'http://vidaserver1.poly.edu:9200/')
      .constant('euiHost', 'http://gray17.poly.edu:5006/')
      // Some text converters for formating search hits
      .filter("asDate", function () {
        return function (input) {
            return new Date(input);
        }
      })
      .filter("asCleanText", function () {
        return function (input) {
          var clean = input;
          clean = clean.replace(/\\n/g, " ");
          clean = clean.replace(/\s\s+/g, ' ' );
          return clean;
        }
      })
      .controller('AcheSearchController', ['$scope', function($scope) {

        $scope.domains = [
          {
            name: 'ATF (Core Forums)',
            index: 'weapons'
          },
          {
            name: 'ATF (ACHE Focused Crawl for April QPR)',
            index: 'achecrawler'
          }
        ];
        
        $scope.currentDomain = $scope.domains[0];

        $scope.changeIndex = function(domainIndex) {
          $scope.currentDomain = $scope.domains[domainIndex];
        }

      }]);
  </script>
</body>
</html>